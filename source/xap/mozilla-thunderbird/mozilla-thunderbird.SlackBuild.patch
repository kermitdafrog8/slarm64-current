--- a/mozilla-thunderbird.SlackBuild	2021-03-02 20:11:00.933457726 +0200
+++ b/mozilla-thunderbird.SlackBuild	2021-03-02 20:19:00.996719513 +0200
@@ -44,6 +44,9 @@
 # "UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 36: ordinal not in range(128)"
 LANG=C
 
+# LTO needs more open files
+ulimit -n 4096
+
 # Add a shell script to start the thunderbird binary with MOZ_ALLOW_DOWNGRADE=1
 # to avoid backing up (and disabling) the user profile if a browser downgrade
 # is detected. If you want to build with the stock default behavior, set
@@ -107,6 +110,14 @@
   SLKCFLAGS="-march=armv4 -mtune=xscale"
   LIBDIRSUFFIX=""
   OPTIMIZE=${OPTIMIZE:-"-O2 -g0"}
+elif [ "$ARCH" = "aarch64" ]; then
+  SLKCFLAGS="-O2 -g0 -fPIC"
+  LIBDIRSUFFIX="64"
+  OPTIMIZE=${OPTIMIZE:-"-O2"}
+elif [ "$ARCH" = "riscv64" ]; then
+  SLKCFLAGS="-O2 -g0 -fPIC"
+  LIBDIRSUFFIX="64"
+  OPTIMIZE=${OPTIMIZE:-"-O2"}
 else
   SLKCFLAGS=""
   LIBDIRSUFFIX=""
@@ -187,6 +198,14 @@
              # Make Thunderbird compile on ARM platforms lacking neon support:
              zcat $CWD/mozilla-firefox.xpcom_arm.patch.gz | patch -p1 --verbose || exit 1
              ;;
+    aarch64) ARCH_CONFIG="--disable-elf-hack"
+             xzcat $CWD/arm.patch.xz | patch -p1 --verbose || exit 1
+             xzcat $CWD/Bug-1238661---fix-mozillaSignalTrampoline-to-work-.patch.xz | patch -p1 --verbose || exit 1
+             ;;
+    riscv64) ARCH_CONFIG="--disable-elf-hack"
+             xzcat $CWD/arm.patch.xz | patch -p1 --verbose || exit 1
+             xzcat $CWD/Bug-1238661---fix-mozillaSignalTrampoline-to-work-.patch.xz | patch -p1 --verbose || exit 1
+             ;;
     *)       ARCH_CONFIG=" "
              ;;
 esac
@@ -261,7 +280,7 @@
 mkdir -p mozilla/obj
 
 # Set options for $OPTIMIZE:
-echo "ac_add_options --enable-optimize=\"${OPTIMIZE}\"" >> .mozconfig
+echo 'ac_add_options --enable-optimize="${OPTIMIZE} -fno-schedule-insns"' >> .mozconfig
 
 if [ "$COMPILE_X86_UNDER_X86_64" = "true" ]; then
   # Compile for i686 under an x86_64 kernel:
