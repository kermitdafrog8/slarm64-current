
rules() {
    if [[ -z $start_kde5_build ]];then
        start_kde5_build="yes"
        remove_work_dir "$t"
        prepare_work_dir "$t"
    fi

    pushd ${SLARM64_SOURCE_PATH}/$t 2>&1>/dev/null
    patching_files STATUS
    popd 2>&1>/dev/null
    pushd ${SLARM64_SOURCE_PATH}/$t/${WORK_DIR} 2>&1>/dev/null
    for file in modules/* ;do
        _MODULE=$(sed '/./{H;$!d};x;/'$p'/!d;' $file | grep -oP '(?<=^#\s).*' | grep -vP '[\s\.]' | sed 's#\:$##g' | head -n1)
        [[ ! -z $_MODULE || $(grep -oP ${p} $file) ]] && break
    done
    if [[ ! -z ${_MODULE} ]];then
        _MODULE=${_MODULE}:${p}
    else
        _MODULE=${file##*/}:${p}
    fi

    ./kde.SlackBuild ${_MODULE} 2>&1 | tee ${p}.build.log
    if [[ ${PIPESTATUS[0]} == 1 ]]; then
        [[ ${t} =~ (^extra$)|(^testing$) ]] && _PKG="${t}/${_PKG}"
        echo "${_PKG}" 2>&1 >> ${BCWD}/build_error.log
    else
        move_pkg ${t##*/} "kde_build/${p}"
    fi
    popd 2>&1>/dev/null
}

rules

